{% extends "base.html" %}

{% block title %}ตั้งค่า - Revenue ETL System{% endblock %}

{% block content %}
<div class="row mb-4">
    <div class="col-12">
        <h2><i class="fas fa-cog"></i> ตั้งค่าระบบ</h2>
    </div>
</div>

<!-- Config Tabs -->
<ul class="nav nav-tabs mb-3" role="tablist">
    <li class="nav-item" role="presentation">
        <button class="nav-link active" id="etl-tab" data-bs-toggle="tab" data-bs-target="#etl-config" type="button" role="tab">
            <i class="fas fa-database"></i> ETL Config
        </button>
    </li>
    <li class="nav-item" role="presentation">
        <button class="nav-link" id="email-tab" data-bs-toggle="tab" data-bs-target="#email-config" type="button" role="tab">
            <i class="fas fa-envelope"></i> Email Config
        </button>
    </li>
    <li class="nav-item" role="presentation">
        <button class="nav-link" id="auth-tab" data-bs-toggle="tab" data-bs-target="#auth-config" type="button" role="tab">
            <i class="fas fa-shield-alt"></i> Auth Config
        </button>
    </li>
</ul>

<div class="tab-content">
    <!-- ETL Config -->
    <div class="tab-pane fade show active" id="etl-config" role="tabpanel">
        <div class="card">
            <div class="card-header bg-primary text-white">
                <i class="fas fa-database"></i> การตั้งค่า ETL
            </div>
            <div class="card-body">
                <form method="POST" action="{{ url_for('admin.config') }}">
                    <input type="hidden" name="config_type" value="etl">

                    <h5 class="mb-3">Paths</h5>
                    <div class="mb-3">
                        <label class="form-label">Data Input Path</label>
                        <input type="text" class="form-control" name="data_input" value="{{ etl_config.paths.data_input }}">
                    </div>
                    <div class="mb-3">
                        <label class="form-label">Master Files Path</label>
                        <input type="text" class="form-control" name="master_files" value="{{ etl_config.paths.master_files }}">
                    </div>

                    <hr>
                    <h5 class="mb-3">Schedule</h5>
                    <div class="mb-3">
                        <div class="form-check">
                            <input type="checkbox" class="form-check-input" name="schedule_enabled" id="schedule_enabled" {% if etl_config.schedule.enabled %}checked{% endif %}>
                            <label class="form-check-label" for="schedule_enabled">
                                เปิดใช้งาน Auto Schedule
                            </label>
                        </div>
                    </div>
                    <div class="row">
                        <div class="col-md-4 mb-3">
                            <label class="form-label">วันที่ (1-31)</label>
                            <input type="number" class="form-control" name="day_of_month" min="1" max="31" value="{{ etl_config.schedule.day_of_month }}">
                        </div>
                        <div class="col-md-4 mb-3">
                            <label class="form-label">ชั่วโมง (0-23)</label>
                            <input type="number" class="form-control" name="hour" min="0" max="23" value="{{ etl_config.schedule.hour }}">
                        </div>
                        <div class="col-md-4 mb-3">
                            <label class="form-label">นาที (0-59)</label>
                            <input type="number" class="form-control" name="minute" min="0" max="59" value="{{ etl_config.schedule.minute }}">
                        </div>
                    </div>

                    <hr>
                    <h5 class="mb-3">Notifications</h5>
                    <div class="mb-3">
                        <div class="form-check">
                            <input type="checkbox" class="form-check-input" name="notifications_enabled" id="notifications_enabled" {% if etl_config.notifications.enabled %}checked{% endif %}>
                            <label class="form-check-label" for="notifications_enabled">
                                ส่ง Email แจ้งเตือนเมื่อเสร็จงาน
                            </label>
                        </div>
                    </div>

                    <div class="d-grid">
                        <button type="submit" class="btn btn-primary">
                            <i class="fas fa-save"></i> บันทึกการตั้งค่า ETL
                        </button>
                    </div>
                </form>
            </div>
        </div>
    </div>

    <!-- Email Config -->
    <div class="tab-pane fade" id="email-config" role="tabpanel">
        <div class="card">
            <div class="card-header bg-primary text-white">
                <i class="fas fa-envelope"></i> การตั้งค่า Email (SMTP)
            </div>
            <div class="card-body">
                <form method="POST" action="{{ url_for('admin.config') }}">
                    <input type="hidden" name="config_type" value="email">

                    <h5 class="mb-3">SMTP Server</h5>
                    <div class="mb-3">
                        <label class="form-label">SMTP Host</label>
                        <input type="text" class="form-control" name="smtp_host" value="{{ email_config.smtp.host }}" required>
                    </div>
                    <div class="mb-3">
                        <label class="form-label">SMTP Port</label>
                        <input type="number" class="form-control" name="smtp_port" value="{{ email_config.smtp.port }}" required>
                    </div>
                    <div class="mb-3">
                        <label class="form-label">SMTP Username</label>
                        <input type="text" class="form-control" name="smtp_username" value="{{ email_config.smtp.username }}" required>
                    </div>
                    <div class="mb-3">
                        <label class="form-label">SMTP Password</label>
                        <input type="password" class="form-control" name="smtp_password" placeholder="(ไม่เปลี่ยนแปลงหากไม่กรอก)">
                        <div class="form-text">เว้นว่างไว้หากไม่ต้องการเปลี่ยนรหัสผ่าน</div>
                    </div>

                    <hr>
                    <h5 class="mb-3">Sender Info</h5>
                    <div class="mb-3">
                        <label class="form-label">Sender Email</label>
                        <input type="email" class="form-control" name="sender_email" value="{{ email_config.sender.email }}" required>
                    </div>
                    <div class="mb-3">
                        <label class="form-label">Sender Name</label>
                        <input type="text" class="form-control" name="sender_name" value="{{ email_config.sender.name }}" required>
                    </div>

                    <div class="d-grid">
                        <button type="submit" class="btn btn-primary">
                            <i class="fas fa-save"></i> บันทึกการตั้งค่า Email
                        </button>
                    </div>
                </form>
            </div>
        </div>
    </div>

    <!-- Auth Config -->
    <div class="tab-pane fade" id="auth-config" role="tabpanel">
        <div class="card">
            <div class="card-header bg-primary text-white">
                <i class="fas fa-shield-alt"></i> การตั้งค่า Authentication
            </div>
            <div class="card-body">
                <form method="POST" action="{{ url_for('admin.config') }}">
                    <input type="hidden" name="config_type" value="auth">

                    <div class="mb-3">
                        <label class="form-label">Allowed Email Domains</label>
                        <textarea class="form-control" name="allowed_domains" rows="5" required>{{ auth_config.allowed_domains|join('\n') }}</textarea>
                        <div class="form-text">ใส่ domain ที่อนุญาตให้เข้าใช้งาน (ทีละบรรทัด)</div>
                    </div>

                    <div class="mb-3">
                        <label class="form-label">Admin Emails</label>
                        <textarea class="form-control" name="admin_emails" rows="5" required>{{ auth_config.admin_emails|join('\n') }}</textarea>
                        <div class="form-text">ใส่อีเมลของ Admin (ทีละบรรทัด)</div>
                    </div>

                    <div class="mb-3">
                        <label class="form-label">Session Timeout (นาที)</label>
                        <input type="number" class="form-control" name="session_timeout" value="{{ auth_config.session.timeout_minutes }}" min="5" max="1440" required>
                    </div>

                    <div class="d-grid">
                        <button type="submit" class="btn btn-primary">
                            <i class="fas fa-save"></i> บันทึกการตั้งค่า Auth
                        </button>
                    </div>
                </form>
            </div>
        </div>
    </div>
</div>
{% endblock %}
