# üìä Crosstab Converter - ‡∏Ñ‡∏π‡πà‡∏°‡∏∑‡∏≠‡∏Å‡∏≤‡∏£‡πÉ‡∏ä‡πâ‡∏á‡∏≤‡∏ô

## üéØ ‡∏Ñ‡∏ß‡∏≤‡∏°‡∏™‡∏≤‡∏°‡∏≤‡∏£‡∏ñ

‡πÅ‡∏õ‡∏•‡∏á‡πÑ‡∏ü‡∏•‡πå Crosstab (Pivot Table) ‚Üí Long Format ‡πÄ‡∏û‡∏∑‡πà‡∏≠‡πÉ‡∏ä‡πâ‡∏Å‡∏±‡∏ö `main_audit.py`

### ‚úÖ ‡∏£‡∏≠‡∏á‡∏£‡∏±‡∏ö 2 ‡πÇ‡∏´‡∏°‡∏î:

| Mode | ‡∏Ñ‡∏≠‡∏•‡∏±‡∏°‡∏ô‡πå‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏• | ‡∏ï‡∏±‡∏ß‡∏≠‡∏¢‡πà‡∏≤‡∏á | Output |
|------|---------------|----------|---------|
| **Date** | ‡∏ß‡∏±‡∏ô‡∏ó‡∏µ‡πà | `2025-01`, `01/01/2025` | YEAR, MONTH, DATE |
| **Sequential** | ‡πÑ‡∏°‡πà‡πÉ‡∏ä‡πà‡∏ß‡∏±‡∏ô‡∏ó‡∏µ‡πà | `1,2,3`, `A,B,C`, `‡∏°.‡∏Ñ.,‡∏Å.‡∏û.` | PERIOD |

---

## üîß ‡∏Å‡∏≤‡∏£‡∏ï‡∏¥‡∏î‡∏ï‡∏±‡πâ‡∏á

```bash
pip install pandas openpyxl
```

---

## üìù ‡∏ß‡∏¥‡∏ò‡∏µ‡πÉ‡∏ä‡πâ‡∏á‡∏≤‡∏ô

### 1. **Date Mode** - ‡∏Ñ‡∏≠‡∏•‡∏±‡∏°‡∏ô‡πå‡πÄ‡∏õ‡πá‡∏ô‡∏ß‡∏±‡∏ô‡∏ó‡∏µ‡πà

#### ‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏ï‡∏±‡∏ß‡∏≠‡∏¢‡πà‡∏≤‡∏á (Input):
```csv
GROUP_NAME,GL_CODE,2025-01,2025-02,2025-03
‡∏Ñ‡πà‡∏≤‡∏ã‡πà‡∏≠‡∏°‡πÅ‡∏ã‡∏°,51642102,24972.44,248531.76,69566.08
```

#### ‡πÇ‡∏Ñ‡πâ‡∏î:
```python
from crosstab_converter import CrosstabConverter

converter = CrosstabConverter(
    input_file="crosstab_data_example.csv",
    output_file="expense_long.csv"
)

converter.convert(
    value_name="EXPENSE_VALUE",
    id_vars=["GROUP_NAME", "GL_CODE", "GL_NAME_NT1"],
    mode='date'  # ‡∏´‡∏£‡∏∑‡∏≠ 'auto'
)
```

#### ‡∏ú‡∏•‡∏•‡∏±‡∏û‡∏ò‡πå (Output):
```csv
YEAR,MONTH,DATE,GROUP_NAME,GL_CODE,GL_NAME_NT1,EXPENSE_VALUE
2025,1,2025-01-01,‡∏Ñ‡πà‡∏≤‡∏ã‡πà‡∏≠‡∏°‡πÅ‡∏ã‡∏°,51642102,‡∏ï-‡∏Ñ‡πà‡∏≤‡∏ã‡πà‡∏≠‡∏°...,24972.44
2025,2,2025-02-01,‡∏Ñ‡πà‡∏≤‡∏ã‡πà‡∏≠‡∏°‡πÅ‡∏ã‡∏°,51642102,‡∏ï-‡∏Ñ‡πà‡∏≤‡∏ã‡πà‡∏≠‡∏°...,248531.76
```

---

### 2. **Sequential Mode** - ‡∏Ñ‡∏≠‡∏•‡∏±‡∏°‡∏ô‡πå‡πÑ‡∏°‡πà‡πÉ‡∏ä‡πà‡∏ß‡∏±‡∏ô‡∏ó‡∏µ‡πà

#### ‡∏ï‡∏±‡∏ß‡∏≠‡∏¢‡πà‡∏≤‡∏á 2.1: ‡∏Ñ‡∏≠‡∏•‡∏±‡∏°‡∏ô‡πå‡πÄ‡∏õ‡πá‡∏ô‡∏ï‡∏±‡∏ß‡πÄ‡∏•‡∏Ç (1,2,3,4)

**Input:**
```csv
PRODUCT,REGION,1,2,3,4
Product A,North,100,150,200,250
```

**‡πÇ‡∏Ñ‡πâ‡∏î:**
```python
converter = CrosstabConverter("example_sequential_numbers.csv")

converter.convert(
    value_name="SALES",
    id_vars=["PRODUCT", "REGION"],
    mode='sequential'
)
```

**Output:**
```csv
PRODUCT,REGION,PERIOD,SALES
Product A,North,1,100
Product A,North,2,150
Product A,North,3,200
Product A,North,4,250
```

---

#### ‡∏ï‡∏±‡∏ß‡∏≠‡∏¢‡πà‡∏≤‡∏á 2.2: ‡∏Ñ‡∏≠‡∏•‡∏±‡∏°‡∏ô‡πå‡πÄ‡∏õ‡πá‡∏ô‡∏ï‡∏±‡∏ß‡∏≠‡∏±‡∏Å‡∏©‡∏£ (A,B,C,D)

**Input:**
```csv
PRODUCT,REGION,A,B,C,D
Product A,North,100,150,200,250
```

**‡πÇ‡∏Ñ‡πâ‡∏î:**
```python
converter = CrosstabConverter("example_sequential_letters.csv")

converter.convert(
    value_name="AMOUNT",
    id_vars=["PRODUCT", "REGION"],
    mode='sequential'
)
```

**Output:**
```csv
PRODUCT,REGION,PERIOD,AMOUNT
Product A,North,A,100
Product A,North,B,150
```

---

#### ‡∏ï‡∏±‡∏ß‡∏≠‡∏¢‡πà‡∏≤‡∏á 2.3: ‡∏Ñ‡∏≠‡∏•‡∏±‡∏°‡∏ô‡πå‡πÄ‡∏õ‡πá‡∏ô‡∏†‡∏≤‡∏©‡∏≤‡πÑ‡∏ó‡∏¢ (‡∏°.‡∏Ñ., ‡∏Å.‡∏û., ‡∏°‡∏µ.‡∏Ñ.)

**Input:**
```csv
PRODUCT,REGION,‡∏°.‡∏Ñ.,‡∏Å.‡∏û.,‡∏°‡∏µ.‡∏Ñ.,‡πÄ‡∏°.‡∏¢.
Product A,North,100,150,200,250
```

**‡πÇ‡∏Ñ‡πâ‡∏î:**
```python
converter = CrosstabConverter("example_sequential_thai_months.csv")

converter.convert(
    value_name="SALES",
    id_vars=["PRODUCT", "REGION"],
    mode='sequential'
)
```

**Output:**
```csv
PRODUCT,REGION,PERIOD,SALES
Product A,North,‡∏°.‡∏Ñ.,100
Product A,North,‡∏Å.‡∏û.,150
Product A,North,‡∏°‡∏µ.‡∏Ñ.,200
```

---

### 3. **Auto Mode** - ‡πÉ‡∏´‡πâ‡πÇ‡∏õ‡∏£‡πÅ‡∏Å‡∏£‡∏°‡∏ï‡∏£‡∏ß‡∏à‡∏™‡∏≠‡∏ö‡πÄ‡∏≠‡∏á (‡πÅ‡∏ô‡∏∞‡∏ô‡∏≥)

```python
converter = CrosstabConverter("data.xlsx")

converter.convert(
    value_name="VALUE",
    id_vars=["DIM1", "DIM2"],
    mode='auto'  # ‡∏ï‡∏£‡∏ß‡∏à‡∏™‡∏≠‡∏ö‡∏≠‡∏±‡∏ï‡πÇ‡∏ô‡∏°‡∏±‡∏ï‡∏¥
)
```

- ‡∏ñ‡πâ‡∏≤‡πÄ‡∏à‡∏≠‡∏Ñ‡∏≠‡∏•‡∏±‡∏°‡∏ô‡πå‡∏ß‡∏±‡∏ô‡∏ó‡∏µ‡πà ‚Üí ‡πÉ‡∏ä‡πâ **Date Mode**
- ‡∏ñ‡πâ‡∏≤‡πÑ‡∏°‡πà‡πÄ‡∏à‡∏≠ ‚Üí ‡πÉ‡∏ä‡πâ **Sequential Mode**

---

## üéØ ‡∏û‡∏≤‡∏£‡∏≤‡∏°‡∏¥‡πÄ‡∏ï‡∏≠‡∏£‡πå‡∏ó‡∏±‡πâ‡∏á‡∏´‡∏°‡∏î

```python
converter.convert(
    sheet_name=0,           # ‡∏ä‡∏∑‡πà‡∏≠/index ‡∏Ç‡∏≠‡∏á sheet (Excel)
    skiprows=0,             # ‡∏Ç‡πâ‡∏≤‡∏°‡πÅ‡∏ñ‡∏ß‡∏ö‡∏ô
    id_vars=["COL1", "COL2"],  # ‡∏Ñ‡∏≠‡∏•‡∏±‡∏°‡∏ô‡πå dimension
    value_name="VALUE",     # ‡∏ä‡∏∑‡πà‡∏≠‡∏Ñ‡∏≠‡∏•‡∏±‡∏°‡∏ô‡πå‡∏Ñ‡πà‡∏≤
    auto_detect_dates=True, # ‡πÉ‡∏´‡πâ‡∏´‡∏≤‡∏ß‡∏±‡∏ô‡∏ó‡∏µ‡πà‡∏≠‡∏±‡∏ï‡πÇ‡∏ô‡∏°‡∏±‡∏ï‡∏¥
    clean=True,             # ‡∏ó‡∏≥‡∏Ñ‡∏ß‡∏≤‡∏°‡∏™‡∏∞‡∏≠‡∏≤‡∏î‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏• (‡∏•‡∏ö null)
    mode='auto'             # 'auto', 'date', 'sequential'
)
```

---

## üß™ ‡∏ó‡∏î‡∏™‡∏≠‡∏ö‡∏Å‡∏±‡∏ö‡πÑ‡∏ü‡∏•‡πå‡∏ï‡∏±‡∏ß‡∏≠‡∏¢‡πà‡∏≤‡∏á

```bash
# ‡∏ó‡∏î‡∏™‡∏≠‡∏ö Date Mode
python crosstab_converter.py

# ‡πÅ‡∏Å‡πâ‡πÑ‡∏Ç‡πÇ‡∏Ñ‡πâ‡∏î‡πÉ‡∏ô‡∏™‡πà‡∏ß‡∏ô __main__ ‡πÉ‡∏´‡πâ‡πÉ‡∏ä‡πâ‡πÑ‡∏ü‡∏•‡πå‡∏ï‡∏±‡∏ß‡∏≠‡∏¢‡πà‡∏≤‡∏á:
# - example_sequential_numbers.csv
# - example_sequential_letters.csv
# - example_sequential_thai_months.csv
# - crosstab_data_example.csv
```

---

## ‚ùì FAQ

### Q1: ‡∏Ñ‡∏≠‡∏•‡∏±‡∏°‡∏ô‡πå‡πÄ‡∏õ‡πá‡∏ô "Jan", "Feb", "Mar" ‡πÉ‡∏ä‡πâ‡πÇ‡∏´‡∏°‡∏î‡πÑ‡∏´‡∏ô?
**A:** ‡πÉ‡∏ä‡πâ `mode='sequential'` ‡πÄ‡∏û‡∏£‡∏≤‡∏∞ pandas ‡πÑ‡∏°‡πà‡∏™‡∏≤‡∏°‡∏≤‡∏£‡∏ñ parse "Jan" ‡πÄ‡∏õ‡πá‡∏ô‡∏ß‡∏±‡∏ô‡∏ó‡∏µ‡πà‡πÄ‡∏ï‡πá‡∏°‡πÑ‡∏î‡πâ

### Q2: ‡∏ñ‡πâ‡∏≤‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏°‡∏µ‡∏´‡∏•‡∏≤‡∏¢ dimensions (‡∏°‡∏≤‡∏Å‡∏Å‡∏ß‡πà‡∏≤ 3 ‡∏Ñ‡∏≠‡∏•‡∏±‡∏°‡∏ô‡πå) ‡πÉ‡∏ä‡πâ‡πÑ‡∏î‡πâ‡πÑ‡∏´‡∏°?
**A:** ‡πÉ‡∏ä‡πâ‡πÑ‡∏î‡πâ! ‡∏£‡∏∞‡∏ö‡∏∏‡πÉ‡∏ô `id_vars` ‡πÑ‡∏î‡πâ‡πÑ‡∏°‡πà‡∏à‡∏≥‡∏Å‡∏±‡∏î
```python
id_vars=["DIM1", "DIM2", "DIM3", "DIM4", "DIM5"]
```

### Q3: ‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏ï‡∏±‡∏ß‡πÄ‡∏•‡∏Ç‡∏°‡∏µ comma (‡πÄ‡∏ä‡πà‡∏ô "1,234.56") ‡∏£‡∏≠‡∏á‡∏£‡∏±‡∏ö‡πÑ‡∏´‡∏°?
**A:** ‡∏£‡∏≠‡∏á‡∏£‡∏±‡∏ö! ‡πÇ‡∏õ‡∏£‡πÅ‡∏Å‡∏£‡∏°‡∏à‡∏∞‡∏•‡∏ö comma ‡∏≠‡∏≠‡∏Å‡∏≠‡∏±‡∏ï‡πÇ‡∏ô‡∏°‡∏±‡∏ï‡∏¥

### Q4: ‡∏ñ‡πâ‡∏≤‡πÑ‡∏°‡πà‡πÅ‡∏ô‡πà‡πÉ‡∏à‡∏ß‡πà‡∏≤‡∏Ñ‡∏ß‡∏£‡πÉ‡∏ä‡πâ‡πÇ‡∏´‡∏°‡∏î‡πÑ‡∏´‡∏ô?
**A:** ‡πÉ‡∏ä‡πâ `mode='auto'` (default) ‡πÇ‡∏õ‡∏£‡πÅ‡∏Å‡∏£‡∏°‡∏à‡∏∞‡πÄ‡∏•‡∏∑‡∏≠‡∏Å‡πÉ‡∏´‡πâ‡πÄ‡∏≠‡∏á

---

## üîó ‡πÄ‡∏ä‡∏∑‡πà‡∏≠‡∏°‡∏ï‡πà‡∏≠‡∏Å‡∏±‡∏ö main_audit.py

‡∏´‡∏•‡∏±‡∏á‡∏à‡∏≤‡∏Å‡πÅ‡∏õ‡∏•‡∏á‡πÄ‡∏™‡∏£‡πá‡∏à ‡πÉ‡∏ä‡πâ‡πÑ‡∏ü‡∏•‡πå‡∏ú‡∏•‡∏•‡∏±‡∏û‡∏ò‡πå‡∏Å‡∏±‡∏ö `main_audit.py`:

```python
# ‡πÉ‡∏ô main_audit.py
INPUT_FILE = "expense_long.csv"  # ‡πÑ‡∏ü‡∏•‡πå‡∏ó‡∏µ‡πà‡πÅ‡∏õ‡∏•‡∏á‡πÅ‡∏•‡πâ‡∏ß

# ‡∏ñ‡πâ‡∏≤‡πÉ‡∏ä‡πâ Sequential Mode ‡πÉ‡∏´‡πâ‡∏õ‡∏£‡∏±‡∏ö‡πÇ‡∏Ñ‡πâ‡∏î‡πÄ‡∏•‡πá‡∏Å‡∏ô‡πâ‡∏≠‡∏¢:
# ‡πÅ‡∏ó‡∏ô‡∏ó‡∏µ‡πà DATE_COL_NAME ‚Üí PERIOD
```

---

## ‚ö†Ô∏è ‡∏Ç‡πâ‡∏≠‡∏Ñ‡∏ß‡∏£‡∏£‡∏∞‡∏ß‡∏±‡∏á

1. **‡πÑ‡∏ü‡∏•‡πå‡∏ï‡πâ‡∏≠‡∏á‡∏°‡∏µ header row** (‡πÅ‡∏ñ‡∏ß‡πÅ‡∏£‡∏Å‡πÄ‡∏õ‡πá‡∏ô‡∏ä‡∏∑‡πà‡∏≠‡∏Ñ‡∏≠‡∏•‡∏±‡∏°‡∏ô‡πå)
2. **Sequential Mode ‡∏à‡∏∞‡πÑ‡∏°‡πà‡∏™‡∏£‡πâ‡∏≤‡∏á YEAR, MONTH, DATE** (‡∏°‡∏µ‡πÅ‡∏Ñ‡πà PERIOD)
3. **‡∏Ñ‡∏≠‡∏•‡∏±‡∏°‡∏ô‡πå ANOMALY_STATUS ‡∏à‡∏∞‡∏ñ‡∏π‡∏Å‡∏•‡∏ö‡∏≠‡∏≠‡∏Å** ‡∏≠‡∏±‡∏ï‡πÇ‡∏ô‡∏°‡∏±‡∏ï‡∏¥
4. **‡∏Ñ‡∏≠‡∏•‡∏±‡∏°‡∏ô‡πå‡∏ú‡∏•‡∏£‡∏ß‡∏° (‡∏ú‡∏•‡∏£‡∏ß‡∏°, Total, SUM) ‡∏à‡∏∞‡∏ñ‡∏π‡∏Å‡∏•‡∏ö‡∏≠‡∏≠‡∏Å** ‡∏≠‡∏±‡∏ï‡πÇ‡∏ô‡∏°‡∏±‡∏ï‡∏¥

---

## üìû ‡∏ï‡∏¥‡∏î‡∏ï‡πà‡∏≠ / ‡∏õ‡∏±‡∏ç‡∏´‡∏≤

- ‡∏ñ‡πâ‡∏≤‡∏°‡∏µ‡∏Ç‡πâ‡∏≠‡∏™‡∏á‡∏™‡∏±‡∏¢ ‡∏ï‡∏£‡∏ß‡∏à‡∏™‡∏≠‡∏ö‡πÑ‡∏ü‡∏•‡πå `crosstab_converter.py`
- ‡∏î‡∏π‡∏ï‡∏±‡∏ß‡∏≠‡∏¢‡πà‡∏≤‡∏á‡πÄ‡∏û‡∏¥‡πà‡∏°‡πÄ‡∏ï‡∏¥‡∏°‡πÉ‡∏ô‡∏™‡πà‡∏ß‡∏ô `if __name__ == "__main__":`

---

**‡∏™‡∏£‡πâ‡∏≤‡∏á‡πÇ‡∏î‡∏¢:** Claude
**‡∏ß‡∏±‡∏ô‡∏ó‡∏µ‡πà:** 2025-01-18
**‡πÄ‡∏ß‡∏≠‡∏£‡πå‡∏ä‡∏±‡∏ô:** 2.0 (‡∏£‡∏≠‡∏á‡∏£‡∏±‡∏ö Sequential Mode)
