{% extends "base.html" %}

{% block title %}Dashboard - {{ app_name }}{% endblock %}

{% block content %}
<h2>ยินดีต้อนรับ, {{ user.email }}</h2>
<p>รายงานรายได้ที่สามารถดาวน์โหลดได้</p>

<div class="stats-box">
    <div class="stat">
        <h3>{{ stats.total_reports }}</h3>
        <p>รายงานทั้งหมด</p>
    </div>
    <div class="stat">
        <h3>{{ stats.total_size_mb }} MB</h3>
        <p>ขนาดรวม</p>
    </div>
</div>

<div class="filter-box">
    <form method="GET">
        <select name="year">
            <option value="">ทุกปี</option>
            {% for y in years %}
            <option value="{{ y }}" {% if y == filter_year %}selected{% endif %}>{{ y }}</option>
            {% endfor %}
        </select>
        <button type="submit" class="btn btn-primary">กรอง</button>
    </form>
</div>

<div class="reports-list">
    <table>
        <thead>
            <tr>
                <th>ชื่อไฟล์</th>
                <th>ขนาด</th>
                <th>วันที่</th>
                <th>ดาวน์โหลด</th>
            </tr>
        </thead>
        <tbody>
            {% for report in reports %}
            <tr>
                <td>{{ report.filename }}</td>
                <td>{{ report.size_mb }} MB</td>
                <td>{{ report.modified[:10] }}</td>
                <td>
                    <a href="{{ url_for('user.download', filename=report.filename) }}" 
                       class="btn btn-sm btn-primary">ดาวน์โหลด</a>
                </td>
            </tr>
            {% else %}
            <tr>
                <td colspan="4" style="text-align: center;">ไม่พบรายงาน</td>
            </tr>
            {% endfor %}
        </tbody>
    </table>
</div>
{% endblock %}
